name: CI

on:
  workflow_dispatch:  # Manual trigger only

jobs:
  test:
    name: Run Tests
    uses: ./.github/workflows/_test.yml
    with:

      run_sqlite: true
      maven_args: 'clean verify'

  build-jar:
    name: Build JAR
    needs: [test]
    uses: ./.github/workflows/_build-jar.yml
    with:

      maven_args: 'clean package -DskipTests'
      artifact_name: 'mcp-database-server'

  build-native:
    name: Build Native
    needs: [test]
    uses: ./.github/workflows/_build-native.yml
    with:

      maven_args: 'clean package -Dnative -DskipTests'
      artifact_name: 'mcp-database-server'
      # Secrets are automatically inherited in reusable workflows called from within the same repo, 
      # but explicit inheritance is clearer or required in some org configs. 
      # "secrets: inherit" is the keyword.
    secrets: inherit
