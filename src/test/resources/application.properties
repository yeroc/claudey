# Test Configuration
# Overrides main application.properties for testing

# Use file-based SQLite for integration tests by default
# Tests can override by setting DB_URL environment variable (e.g., for PostgreSQL testing)
# File-based allows multiple connections to share the same database state
# TestDatabaseUrlProvider creates isolated databases per test class (e.g., CliQueryTest.db)
# for proper test isolation and parallel execution support
quarkus.datasource.jdbc.url=${DB_URL:jdbc:sqlite:target/test-database.db}
quarkus.datasource.username=${DB_USERNAME:}
quarkus.datasource.password=${DB_PASSWORD:}

# Logging Configuration for Tests
# Re-enable console logging (production disables it for stdio compatibility)
quarkus.log.console.enable=true
quarkus.log.file.enable=false

# Test Hang Detection
quarkus.test.hang-detection-timeout=60s

# Disable DatabaseInfoLogger in tests (can cause connection pool issues)
quarkus.arc.exclude-types=org.geekden.mcp.config.DatabaseInfoLogger

# HikariCP Debug Logging
quarkus.log.category."com.zaxxer.hikari".level=DEBUG
quarkus.log.category."com.zaxxer.hikari.pool".level=TRACE

# HikariCP Leak Detection (log stack trace if connection held > 2 seconds)
hikari.leak-detection-threshold=2000

# Disable JTA transactions for tests (they interfere with connection pooling)
quarkus.transaction-manager.enable-recovery=false
quarkus.narayana.jta.enabled=false
